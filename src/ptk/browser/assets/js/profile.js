/* Author: Denis Podgurskii */
import { ptk_controller_settings } from "../../../controller/settings.js"
const controller = new ptk_controller_settings()


jQuery(function () {

    $('.save_apikey').on('click', function () {

        let $form = $('#profile_form'), values = $form.form('get values')
        Object.keys(values).map((k) => { if (values[k] === 'on') values[k] = true })
        controller.save('profile', values)

        controller.restore().then(function (s) {
            controller.on_updated_settings(s)
        })
    })

    $('#settings_reset').on('click', function () {
        controller.reset().then(function (s) {
            $(document).trigger("init_forms", s.settings)
        })
    })
    controller.restore().then(function (s) {
        $(document).trigger("init_forms", s)
    })
})


$(document).on("init_forms", function (e, s) {

    Object.entries(s.profile).forEach(([key, value]) => {
        if ($('#profile_form').form('has field', key)) {
            $('#profile_form').form('set value', key, value)
        }
    })

})
